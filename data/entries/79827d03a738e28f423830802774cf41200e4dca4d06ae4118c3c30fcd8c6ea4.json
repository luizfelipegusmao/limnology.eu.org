{"title":"Amazon GuardDuty Now Supports Amazon EKS Runtime Monitoring","link":"https://aws.amazon.com/blogs/aws/amazon-guardduty-now-supports-amazon-eks-runtime-monitoring/","date":1680210223000,"content":"<p>Since Amazon GuardDuty <a href=\"https://aws.amazon.com/blogs/aws/amazon-guardduty-continuous-security-monitoring-threat-detection/\">launched in 2017</a>, GuardDuty has been capable of analyzing tens of billions of events per minute across multiple AWS data sources, such as <a href=\"https://aws.amazon.com/cloudtrail\">AWS CloudTrail</a> event logs, <a href=\"https://aws.amazon.com/vpc\">Amazon Virtual Private Cloud</a> (Amazon VPC) Flow Logs, and DNS query logs, <a href=\"https://aws.amazon.com/s3\">Amazon Simple Storage Service</a> (Amazon S3) data plane events, <a href=\"https://aws.amazon.com/eks\">Amazon Elastic Kubernetes Service</a> (Amazon EKS) audit logs, and <a href=\"https://aws.amazon.com/rds\">Amazon Relational Database Service</a> (Amazon RDS) login events to protect your AWS accounts and resources.</p> \n<p>In 2020, GuardDuty added <a href=\"https://aws.amazon.com/blogs/aws/new-using-amazon-guardduty-to-protect-your-s3-buckets/\"><strong>Amazon S3 protection</strong></a> to continuously monitor and profile S3 data access events and configurations to detect <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-s3.html\">suspicious activities in Amazon S3</a>. Last year, GuardDuty launched <strong><a href=\"https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-guardduty-elastic-kubernetes-service-clusters/\">Amazon EKS protection</a></strong> to monitor control plane activity by analyzing Kubernetes audit logs from existing and new EKS clusters in your accounts, <a href=\"https://aws.amazon.com/blogs/aws/new-for-amazon-guardduty-malware-detection-for-amazon-ebs-volumes/\"><strong>Amazon EBS malware protection</strong></a> to scan malicious files residing on an EC2 instance or container workload using EBS volumes, and <a href=\"https://aws.amazon.com/about-aws/whats-new/2022/11/amazon-guardduty-rds-protection-preview/\"><strong>Amazon RDS protection</strong></a> to identify potential threats to data stored in <a href=\"https://aws.amazon.com/rds/aurora/\">Amazon Aurora</a> databases—recently <a href=\"https://aws.amazon.com/about-aws/whats-new/2023/03/amazon-guardduty-rds-protection-aurora-generally-available/\">generally available</a>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/23/2023-guardduty-1-diagram.jpg\" alt width=\"2858\" height=\"1231\" /></p> \n<p>GuardDuty combines machine learning (ML), anomaly detection, network monitoring, and malicious file discovery using various AWS data sources. When threats are detected, GuardDuty automatically sends security findings to <a href=\"https://aws.amazon.com/security-hub/\">AWS Security Hub</a>, <a href=\"https://aws.amazon.com/eventbridge/\">Amazon EventBridge</a>, and <a href=\"https://aws.amazon.com/detective/\">Amazon Detective</a>. These integrations help centralize monitoring for AWS and partner services, automate responses to malware findings, and perform security investigations from GuardDuty.</p> \n<p>Today, we are announcing the general availability of <strong>Amazon GuardDuty EKS Runtime Monitoring </strong>to detect runtime threats from over 30 security findings to protect your EKS clusters. The new EKS Runtime Monitoring uses a fully managed EKS add-on that adds visibility into individual container runtime activities, such as file access, process execution, and network connections.</p> \n<p>GuardDuty can now identify specific containers within your EKS clusters that are potentially compromised and detect attempts to escalate privileges from an individual container to the underlying Amazon EC2 host and the broader AWS environment. GuardDuty EKS Runtime Monitoring findings provide metadata context to identify potential threats and contain them before they escalate.</p> \n<p><strong><u>Configure EKS Runtime Monitoring in GuardDuty</u></strong><br /> To get started, first enable <strong>EKS Runtime Monitoring</strong> with just a few clicks in the <a href=\"https://console.aws.amazon.com/guardduty/home?#/k8s-protection\">GuardDuty console</a>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/23/2023-guardduty-2-configure.jpg\" alt width=\"2185\" height=\"1275\" /></p> \n<p>Once you enable <strong>EKS Runtime Monitoring</strong>, GuardDuty can start monitoring and analyzing the runtime-activity events for all the existing and new EKS clusters for your accounts. If you want GuardDuty to deploy and update the required EKS-managed add-on for all the existing and new EKS clusters in your account, choose <strong>Manage agent automatically</strong>. This will also create a VPC endpoint through which the security agent delivers the runtime events to GuardDuty.</p> \n<p>If you configure <strong>EKS Audit Log Monitoring</strong> and runtime monitoring together, you can achieve optimal EKS protection both at the cluster control plane level, and down to the individual pod or container operating system level. When used together, threat detection will be more contextual to allow quick prioritization and response. For example, a runtime-based detection on a pod exhibiting suspicious behavior can be augmented by an audit log-based detection, indicating the pod was unusually launched with elevated privileges.</p> \n<p>These options are default, but they are configurable, and you can uncheck one of the boxes in order to disable EKS Runtime Monitoring. When you disable EKS Runtime Monitoring, GuardDuty immediately stops monitoring and analyzing the runtime-activity events for all the existing EKS clusters. If you had configured automated agent management through GuardDuty, this action also removes the security agent that GuardDuty had deployed.</p> \n<p><strong><u>Manage GuardDuty Agent Manually</u></strong><br /> If you want to manually deploy and update the EKS managed add-on, including the GuardDuty agent, per cluster in your account, uncheck <strong>Manage agent automatically</strong> in the EKS protection configuration.</p> \n<p>When managing the add-on manually, you are also responsible for creating the VPC endpoint through which the security agent delivers the runtime events to GuardDuty. In the <a href=\"https://console.aws.amazon.com/vpc/home?#Endpoints:\">VPC endpoint console</a>, choose <strong>Create endpoint</strong>. In the step, choose <strong>Other endpoint services</strong> for <strong>Service category</strong>, enter <code>com.amazonaws.us-east-1.guardduty-data</code> for <strong>Service name</strong> in the US East (N. Virginia) Region, and choose <strong>Verify service</strong>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/23/2023-guardduty-eks-vpc-endpoint.jpg\" alt width=\"1654\" height=\"1214\" /></p> \n<p>After the service name is successfully verified, choose VPC and subnets where your EKS cluster resides. Under <strong>Additional settings</strong>, choose <strong>Enable DNS name</strong>. Under <strong>Security groups,</strong> choose a security group that has the in-bound port 443 enabled from your VPC (or your EKS cluster).</p> \n<p>Add the following policy to restrict VPC endpoint usage to the specified account only:</p> \n<pre><code>{\n\t\"Version\": \"2012-10-17\",\n\t\"Statement\": [\n\t\t{\n\t\t\t\"Action\": \"*\",\n\t\t\t\"Resource\": \"*\",\n\t\t\t\"Effect\": \"Allow\",\n\t\t\t\"Principal\": \"*\"\n\t\t},\n\t\t{\n\t\t\t\"Condition\": {\n\t\t\t\t\"StringNotEquals\": {\n\t\t\t\t\t\"aws:PrincipalAccount\": \"123456789012\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"Action\": \"*\",\n\t\t\t\"Resource\": \"*\",\n\t\t\t\"Effect\": \"Deny\",\n\t\t\t\"Principal\": \"*\"\n\t\t}\n\t]\n}</code></pre> \n<p>Now, you can install the <strong>Amazon GuardDuty EKS Runtime Monitoring</strong> add-on for your EKS clusters. Select this add-on in the <strong>Add-ons</strong> tab in your EKS cluster profile on the <a href=\"https://console.aws.amazon.com/eks/home?#/clusters/\">Amazon EKS console</a>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/23/2023-guardduty-3-eks-addons.jpg\" alt width=\"2045\" height=\"1052\" /></p> \n<p>When you enable EKS Runtime Monitoring in GuardDuty and deploy the Amazon EKS add-on for your EKS cluster, you can view the new pods with the prefix <code>amazon-guardduty-agent</code>. GuardDuty now starts to consume runtime-activity events from all EC2 hosts and containers in the cluster. GuardDuty then analyzes these events for potential threats.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/23/2023-guardduty-4-eks-addons.jpg\" alt width=\"1827\" height=\"1297\" /></p> \n<p>These pods collect various event types and send them to the GuardDuty backend for threat detection and analysis. When managing the add-on manually, you need to go through these steps for each EKS cluster that you want to monitor, including new EKS clusters. To learn more, see <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html\">Managing GuardDuty agent manually</a> in the AWS documentation.</p> \n<p><strong><u>Checkout EKS Runtime Security Findings</u></strong><br /> When GuardDuty detects a potential threat and generates a security finding, you can view the details of the corresponding findings. These security findings indicate either a compromised EC2 instance, container workload, an EKS cluster, or a set of compromised credentials in your AWS environment.</p> \n<p>If you want to generate EKS Runtime Monitoring sample findings for testing purposes, see <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/sample_findings.html\">Generating sample findings in GuardDuty</a> in the AWS documentation. Here is an example of potential security issues: a newly created or recently modified binary file in an EKS cluster has been executed.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/28/2023-guardduty-eks-example-security-finding-1.jpg\" alt width=\"2440\" height=\"1082\" /></p> \n<p>The <strong>ResourceType</strong> for an EKS Protection finding type could be an <code>Instance</code>, <code>EKSCluster</code>, or <code>Container</code>. If the <strong>Resource type</strong> in the finding details is <code>EKSCluster</code>, it indicates that either a pod or a container inside an EKS cluster is potentially compromised. Depending on the potentially compromised resource type, the finding details may contain Kubernetes workload details, EKS cluster details, or instance details.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/28/2023-guardduty-eks-example-security-finding-pod-detail.png\" alt width=\"1425\" height=\"775\" /></p> \n<p>The <strong>Runtime details</strong> such as process details and any required context describe information about the observed process, and the runtime context describes any additional information about the potentially suspicious activity.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/28/2023-guardduty-eks-example-security-finding-runtime-detail.png\" alt width=\"1443\" height=\"644\" /></p> \n<p>To remediate a compromised pod or container image, see <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-remediate-kubernetes.html\">Remediating Kubernetes security issues discovered by GuardDuty</a> in the AWS documentation. This document describes the recommended remediation steps for each resource type. To learn more about security finding types, see <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html\">GuardDuty EKS Runtime Monitoring finding types</a> in the AWS documentation.</p> \n<p><strong><u>Now Available</u></strong><br /> You can now use Amazon GuardDuty for EKS Runtime Monitoring. For a full list of Regions where EKS Runtime Monitoring is available, visit <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_regions.html#gd-regional-feature-availability\">region-specific feature availability</a>.</p> \n<p>The first 30 days of GuardDuty for EKS Runtime Monitoring are available at no additional charge for existing GuardDuty accounts. If you enabled GuardDuty for the first time, EKS Runtime Monitoring is not enabled by default, and needs to be enabled as described above. After the trial period ends in the GuardDuty, you can see the estimated cost of EKS Runtime Monitoring. To learn more, see the <a href=\"https://aws.amazon.com/guardduty/pricing/\">GuardDuty pricing</a> page.</p> \n<p>For more information, see the <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html\">Amazon GuardDuty User Guide</a> and send feedback to <a href=\"https://repost.aws/tags/questions/TAkQ_AMw65SICuEGEmuUXv4g?view=all\">AWS re:Post for Amazon GuardDuty</a> or through your usual AWS support contacts.</p> \n<p>– <a href=\"https://twitter.com/channyun\">Channy</a></p>","author":"Channy Yun","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"79827d03a738e28f423830802774cf41200e4dca4d06ae4118c3c30fcd8c6ea4","category":"Tech"}