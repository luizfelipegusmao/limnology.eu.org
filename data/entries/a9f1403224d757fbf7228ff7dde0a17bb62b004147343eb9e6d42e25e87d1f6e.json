{"title":"Enhanced Amazon S3 Integration for Amazon FSx for Lustre","link":"https://aws.amazon.com/blogs/aws/enhanced-amazon-s3-integration-for-amazon-fsx-for-lustre/","date":1638318100000,"content":"<p>Today, we are announcing two additional capabilities of <a href=\"https://aws.amazon.com/fsx/lustre/\">Amazon FSx for Lustre</a>. First, a full bi-directional synchronization of your file systems with <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (Amazon S3)</a>, including deleted files and objects. Second, the ability to synchronize your file systems with multiple S3 buckets or prefixes.</p> \n<p>Lustre is a large scale, distributed parallel file system powering the workloads of most of the largest supercomputers. It is popular among AWS customers for high-performance computing workloads, such as meteorology, life-science, and engineering simulations. It is also used in media and entertainment, as well as the financial services industry.</p> \n<p>I had my first hands-on <a href=\"https://en.wikipedia.org/wiki/Lustre_(file_system)\">Lustre file systems</a> when I was working for <a href=\"https://en.wikipedia.org/wiki/Sun_Microsystems\">Sun Microsystems</a>. I was a pre-sales engineer and worked on some deals to sell multimillion-dollar compute and storage infrastructure to financial services companies. Back then, having access to a Lustre file system was a luxury. It required expensive compute, storage, and network hardware. We had to wait weeks for delivery. Furthermore, it required days to install and configure a cluster.</p> \n<p>Fast forward to 2021, I may create a petabyte-scale Lustre cluster and attach the file system to compute resources running in the AWS cloud, on-demand, and only pay for what I use. There is no need to know about <a href=\"https://en.wikipedia.org/wiki/Storage_area_network\">Storage Area Networks</a> (SAN), <a href=\"https://en.wikipedia.org/wiki/Fibre_Channel\">Fiber Channel (FC) fabric</a>, and other underlying technologies.</p> \n<p>Modern applications use different storage options for different workloads. It is common to use S3 object storage for data transformation, preparation, or import/export tasks. Other workloads may require POSIX file-systems to access the data. FSx for Lustre lets you synchronize objects stored on S3 with the Lustre file system to meet these requirements.</p> \n<p>When you link your S3 bucket to your file system, FSx for Lustre transparently presents S3 objects as files and lets you to write results back to S3.</p> \n<p><span><strong>Full Bi-Directional Synchronization with Multiple S3 Buckets<br /> </strong></span>If your workloads require a fast, POSIX-compliant file system access to your S3 buckets, then you can use FSx for Lustre to link your S3 buckets to a file system and keep data synchronized between the file system and S3 in both directions. However, until today, there were a couple limitations. First, you had to manually configure a task to export data back from FSx for Lustre to S3. Second, deleted files on S3 were not automatically deleted from the file system. And third, an FSx for Lustre file system was synchronized with one S3 bucket only. We are addressing these three challenges with this launch.</p> \n<p>Starting today, when you configure an automatic export policy for your data repository association, files on your FSx for Lustre file system are automatically exported to your data repository on S3. Next, deleted objects on S3 are now deleted from the FSx for Lustre file system. The opposite is also available: deleting files on FSx for Lustre triggers the deletion of corresponding objects on S3. Finally, you may now synchronize your FSx for Lustre file system with multiple S3 buckets. Each bucket has a different path at the root of your Lustre file system. For example your S3 bucket <code>logs</code> may be mapped to <code>/fsx/logs</code> and your other <code>financial_data</code> bucket may be mapped to <code>/fsx/finance</code>.</p> \n<p>These new capabilities are useful when you must concurrently process data in S3 buckets using both a file-based and an object-based workflow, as well as share results in near real time between these workflows. For example, an application that accesses file data can do so by using an FSx for Lustre file system linked to your S3 bucket, while another application running on <a href=\"https://aws.amazon.com/emr\">Amazon EMR</a> may process the same files from S3.</p> \n<p>Moreover, you may link multiple S3 buckets or prefixes to a single FSx for Lustre file system, thereby enabling a unified view across multiple datasets. Now you can create a single FSx for Lustre file system and easily link multiple S3 data repositories (S3 buckets or prefixes). This is convenient when you use multiple S3 buckets or prefixes to organize and manage access to your data lake, access files from a public S3 bucket (such as <a href=\"https://registry.opendata.aws/\">these hundreds of public datasets</a>) and write job outputs to a different S3 bucket, or when you want to use a larger FSx for Lustre file system linked to multiple S3 datasets to achieve greater scale-out performance.</p> \n<p><span><strong>How It Works<br /> </strong></span>Let’s create an FSx for Lustre file system and attach it to an <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (Amazon EC2)</a> instance. I make sure that the file system and instance are in the same VPC subnet to minimize data transfer costs. The file system security group must authorize access from the instance.</p> \n<p>I open the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a>, navigate to <strong>FSx</strong>, and select <strong>Create file system. </strong>Then, I select <strong>Amazon FSx for Lustre</strong>. I am not going through all of the options to create a file system here, <a href=\"https://docs.aws.amazon.com/fsx/latest/LustreGuide/getting-started-step1.html\">you can refer to the documentation to learn how to create a file system</a>. I make sure that <strong>Import data from and export data to S3</strong> is selected.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/16/2021-11-16_10-25-05.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/16/2021-11-16_10-25-05-1024x285.png\" /></a>It takes a few minutes to create the file system. Once the status is <img src=\"https://s.w.org/images/core/emoji/12.0.0-1/72x72/2705.png\" /> <strong>Available</strong>, I navigate to the <strong>Data repository</strong> tab, and then select <strong>Create data repository association</strong>.</p> \n<p>I choose a <strong>Data Repository path</strong> (my source S3 bucket) and a <strong>file system path</strong> (where in the file system that bucket will be imported).</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_10-02-09.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_10-02-09-1024x603.png\" /></a></p> \n<p>Then, I choose the <strong>Import policy</strong> and <strong>Export policy</strong>. I may synchronize the creation of file/objects, their updates, and when they are deleted. I select <strong>Create</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/16/2021-11-16_10-31-37.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/16/2021-11-16_10-31-37-994x1024.png\" /></a></p> \n<p>When I use automatic import, I also make sure to provide an S3 bucket in the same AWS Region as the FSx for Lustre cluster. FSx for Lustre supports linking to an S3 bucket in a different AWS Region for automatic export and all other capabilities.</p> \n<p>Using the console, I see the list of <strong>Data repository associations</strong>. I wait for the import task status to become <img src=\"https://s.w.org/images/core/emoji/12.0.0-1/72x72/2705.png\" /> <strong>Succeeded</strong>. If I link the file system to an S3 bucket with a large number of objects, then I may choose to skip <strong>Importing metadata from repository</strong> while creating the data repository association, and then load metadata from selected prefixes in my S3 buckets that are required for my workload using an <strong>Import task</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_09-58-34.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_09-58-34-1024x386.png\" /></a></p> \n<p>I create an EC2 instance in the same VPC subnet. Furthermore, I make sure that the FSx for Lustre cluster security group authorizes ingress traffic from the EC2 instance. I use SSH to connect to the instance, and then type the following commands (commands are prefixed with the <code>$</code> sign that is part of my shell prompt).</p> \n<pre><code># check kernel version, minimum version 4.14.104-95.84 is required \n$ uname -r\n4.14.252-195.483.amzn2.aarch64\n\n# install lustre client \n$ sudo amazon-linux-extras install -y lustre2.10\nInstalling lustre-client\n...\nInstalled:\n  lustre-client.aarch64 0:2.10.8-5.amzn2                                                                                                                        \n\nComplete!\n\n# create a mount point \n$ sudo mkdir /fsx\n\n# mount the file system \n$ sudo mount -t lustre -o noatime,flock fs-00...9d.fsx.us-east-1.amazonaws.com@tcp:/ny345bmv /fsx\n\n# verify mount succeeded\n$ mount \n...\n172.0.0.0@tcp:/ny345bmv on /fsx type lustre (rw,noatime,flock,lazystatfs)\n</code></pre> \n<p>Then, I verify that the file system contains the S3 objects, and I create a new file using the <code>touch</code> command.</p> \n<p><strong><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_17-09-14.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_17-09-14-1024x433.png\" /></a></strong></p> \n<p>I switch to the AWS Console, under S3 and then my bucket name, and I verify that the file has been synchronized.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_17-07-57.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_17-07-57-1024x383.png\" /></a></p> \n<p>Using the console, I delete the file from S3. And, unsurprisingly, after a few seconds, the file is also deleted from the FSx file system.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_21-01-10.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/11/18/2021-11-18_21-01-10-1024x211.png\" /></a></p> \n<p><strong><span>Pricing and Availability<br /> </span></strong>These new capabilities are available at no additional cost on Amazon FSx for Lustre file systems. Automatic export and multiple repositories are only available on Persistent 2 file systems in US East (N. Virginia), US East (Ohio), US West (Oregon), Canada (Central), Asia Pacific (Tokyo), Europe (Frankfurt), and Europe (Ireland). Automatic import with support for deleted and moved objects in S3 is available on file systems created after July 23, 2020 in all regions where FSx for Lustre is available.</p> \n<p>You can configure your file system to automatically import S3 updates by using the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a>, the <a href=\"https://aws.amazon.com/cli/\">AWS Command Line Interface (CLI)</a>, and <a href=\"https://aws.amazon.com/tools/\">AWS SDKs</a>.</p> \n<p><a href=\"https://docs.aws.amazon.com/fsx/latest/LustreGuide/create-dra-linked-data-repo.html\">Learn more about using S3 data repositories with Amazon FSx for Lustre file systems</a>.</p> \n<p><span><strong>One More Thing</strong></span><br /> One more thing while you are reading. Today, we also launched the next generation of FSx for Lustre file systems. FSx for Lustre next-gen file systems are built on <a href=\"https://aws.amazon.com/ec2/graviton/\">AWS Graviton</a> processors. They are designed to provide you with up to 5x higher throughput per terabyte (up to 1 GB/s per terabyte) and reduce your cost of throughput by up to 60% as compared to previous generation file systems. Give it a try today!</p> \n<a href=\"https://twitter.com/sebsto\">-- seb</a> \n<p>PS : <a href=\"https://www.linkedin.com/in/michaelmoussa/\">my colleague Michael</a> recorded a demo video to show you the enhanced S3 integration for FSx for Lustre in action. <a href=\"https://youtu.be/LcTVHmBS7Us\">Check it out today</a>.</p> \n<p></p>","author":"Sébastien Stormacq","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"a9f1403224d757fbf7228ff7dde0a17bb62b004147343eb9e6d42e25e87d1f6e","category":"Tech"}