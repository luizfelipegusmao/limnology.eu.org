{"title":"[MQTT] ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ MQTT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Sonoff ‡∏î‡πâ‡∏ß‡∏¢ NodeJS ‡∏Ñ‡∏£‡∏±‡∏ö","link":"https://thanapon.info/sonoff-mqtt/","date":1599916339000,"content":"<p id=\"6d9c\">‡∏™‡∏∑‡∏ö‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≤‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ú‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î TASMOTA firmware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sonoff ‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô MQTT ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö NodeJS</p>\n\n\n\n<p id=\"2c4d\">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Web Application ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Sonoff ‡πÇ‡∏î‡∏¢‡∏ú‡πà‡∏≤‡∏ô MQTT Protocol ‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡πÑ‡∏õ‡∏™‡∏≤‡∏¢ developer ‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏ú‡∏°‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î code ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà github ‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö&#8230;</p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p><a href=\"http://thanapon.info/?p=92\" target=\"_blank\" rel=\"noreferrer noopener\">[ESP8266-Sonoff] ‡∏°‡∏≤‡∏•‡∏≠‡∏á TASMOTA firmware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sonoff ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</a></p><cite>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô<br>‡∏û‡∏≠‡∏î‡∏µ‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏õ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô Sonoff ‡∏°‡∏≤ ‡∏ã‡∏∂‡πà‡∏á‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≠‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Module Sonoff Basic ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏à‡∏∞‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÜ‡∏Å‡∏±‡∏ö‡∏ö‡∏±‡∏•‡∏•‡∏≤‡∏™‡∏ï‡πå‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏à‡∏∞‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏•‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö</cite></blockquote>\n\n\n\n<blockquote class=\"wp-block-quote\"><p><a href=\"http://thanapon.info/?p=94\" target=\"_blank\" rel=\"noreferrer noopener\">[MQTT] ‡∏•‡∏≠‡∏á MQTT ‡∏ö‡∏ô NodeJS ‡πÄ‡∏ñ‡∏≠‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</a></p><cite>MQTT (Message Queueing Telemetry Transport protocol)‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á m2m ‡∏´‡∏£‡∏∑‡∏≠ machine to machine</cite></blockquote>\n\n\n<h2 id=\"52c4\" data-selectable-paragraph=\"\">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á express-generator ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>\n<p id=\"d567\" data-selectable-paragraph=\"\">‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏ô‡∏≥ MQTT ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á web application ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß express-generator ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á application ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà view engine ‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏ä‡πâ EJS ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö‡∏ã‡∏∂‡πà‡∏á syntax ‡∏à‡∏∞‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÜ‡∏Å‡∏±‡∏ö html ‡∏°‡∏≤‡∏Å‡πÜ‡∏Ñ‡∏£‡∏±‡∏ö</p>\n<pre>$ express --view=ejs nodejs-tasmota</pre>\n<p id=\"1b77\" data-selectable-paragraph=\"\">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå nodejs-tasmota ‡∏°‡∏≤ ‡πÇ‡∏î‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢</p>\n<pre>‚îú‚îÄ‚îÄ app.js\n‚îú‚îÄ‚îÄ bin\n‚îÇ   ‚îî‚îÄ‚îÄ www\n‚îú‚îÄ‚îÄ package.json\n‚îú‚îÄ‚îÄ public\n‚îÇ   ‚îú‚îÄ‚îÄ images\n‚îÇ   ‚îú‚îÄ‚îÄ javascripts\n‚îÇ   ‚îî‚îÄ‚îÄ stylesheets\n‚îÇ       ‚îî‚îÄ‚îÄ style.css\n‚îú‚îÄ‚îÄ routes\n‚îÇ   ‚îú‚îÄ‚îÄ index.js\n‚îÇ   ‚îî‚îÄ‚îÄ users.js\n‚îî‚îÄ‚îÄ views\n    ‚îú‚îÄ‚îÄ error.ejs\n    ‚îú‚îÄ‚îÄ index.ejs</pre>\n<p id=\"4a7f\" data-selectable-paragraph=\"\">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á web application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô <em>npm install</em> ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á package ‡∏ï‡πà‡∏≤‡∏á‡πÜ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô <em>npm start</em> ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö</p>\n<section>\n<p id=\"4a7f\" data-selectable-paragraph=\"\">\n</p><pre>$ npm install // Install package dependencies\n$ npm start   // Start service</pre>\n<p id=\"c2d4\" data-selectable-paragraph=\"\">‡∏°‡∏≤‡∏ó‡∏µ‡πà Web browser ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Google chrome ‡∏´‡∏£‡∏∑‡∏≠ Microsoft Edge ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á address : <a href=\"http://localhost:3000\" rel=\"noopener nofollow\"><strong>http://localhost:3000</strong></a> ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á web application ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT ‡πÅ‡∏•‡∏∞ Tasmota</p>\n<figure>&nbsp;<img loading=\"lazy\" src=\"https://miro.medium.com/max/1920/1*eCG3UkL7iHRFz-4LwGxZgw.png\" sizes=\"700px\" srcset=\"https://miro.medium.com/max/276/1*eCG3UkL7iHRFz-4LwGxZgw.png 276w, https://miro.medium.com/max/552/1*eCG3UkL7iHRFz-4LwGxZgw.png 552w, https://miro.medium.com/max/640/1*eCG3UkL7iHRFz-4LwGxZgw.png 640w, https://miro.medium.com/max/700/1*eCG3UkL7iHRFz-4LwGxZgw.png 700w\" alt=\"Image for post\" class=\"aligncenter\" width=\"1920\" height=\"1030\"></figure>\n</section>\n<section>\n<h2 id=\"aa20\" data-selectable-paragraph=\"\">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ nodejs-mqtt ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢</h2>\n<p id=\"99bd\" data-selectable-paragraph=\"\">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á package MQTT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö web application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</p>\n<pre>$ npm install mqtt</pre>\n<p id=\"aef2\" data-selectable-paragraph=\"\">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå <strong>app.js </strong>‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö mqtt ‡πÑ‡∏î‡πâ</p>\n</section>\n\n\n<div class=\"hcb_wrap\"><pre class=\"prism line-numbers lang-js\" data-lang=\"JavaScript\"><code>const createError = require(&#39;http-errors&#39;);\nconst express = require(&#39;express&#39;);\nconst path = require(&#39;path&#39;);\nconst cookieParser = require(&#39;cookie-parser&#39;);\nconst logger = require(&#39;morgan&#39;);\n\n//------------MQTT section------------//\nconst mqtt = require(&#39;mqtt&#39;)  // import mqtt connect\n// mqtt configuration\nconst mqttConfig = {\n  host: &#39;localhost&#39;,\n  port: 1883,\n  username: &#39;&#39;,\n  password: &#39;&#39;\n}\nconst client  = mqtt.connect(mqttConfig) // create connection to mqtt broker\nclient.on(&#39;connect&#39;, function () {\n  client.subscribe(&#39;tasmota/#&#39;, function (err) {\n    if (!err) {\n      client.publish(&#39;tasmota&#39;, &#39;Hello from application mqtt&#39;)\n    }\n  })\n})\n \nclient.on(&#39;message&#39;, function (topic, message) {\n  // message is Buffer\n  console.log(message.toString())\n})\n//------------------------------------//\n\nconst indexRouter = require(&#39;./routes/index&#39;);\n\nconst app = express();\n\n// view engine setup\napp.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));\napp.set(&#39;view engine&#39;, &#39;ejs&#39;);\n\napp.use(logger(&#39;dev&#39;));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, &#39;public&#39;)));\n\n// Route endpoint\nindexRouter(app,client)\n\n// catch 404 and forward to error handler\napp.use(function(req, res, next) {\n  next(createError(404));\n});\n\n// error handler\napp.use(function(err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message;\n  res.locals.error = req.app.get(&#39;env&#39;) === &#39;development&#39; ? err : {};\n\n  // render the error page\n  res.status(err.status || 500);\n  res.render(&#39;error&#39;);\n});\n\nmodule.exports = app;\n</code></pre></div>\n\n\n\n<p id=\"c9e7\">‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î topic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö subscribe ‡πÄ‡∏õ‡πá‡∏ô ‚Äú<strong><em>tasmota/#‚Äù</em></strong> ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p># ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ topic ‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ prefix ‚Äútasmota‚Äù</p></blockquote>\n\n\n\n<p id=\"2e4e\">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå <strong><em>views/index.ejs </em></strong>‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡πÄ‡∏à‡πâ‡∏≤‡∏ï‡∏±‡∏ß Sonoff ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå <strong><em>views/index.ejs </em></strong>‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° html button tag ‡∏Å‡∏±‡∏ô </p>\n\n\n\n<div class=\"hcb_wrap\"><pre class=\"prism line-numbers lang-html\" data-lang=\"HTML\"><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/stylesheets/style.css&quot; /&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;\n    &lt;p&gt;Welcome nodejs-tasmota&lt;/p&gt;\n    &lt;button id=&quot;butt_on&quot;&gt;‡πÄ‡∏õ‡∏¥‡∏î&lt;/button&gt;\n    &lt;button id=&quot;butt_off&quot;&gt;‡∏õ‡∏¥‡∏î&lt;/button&gt;\n  &lt;/body&gt;\n  &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js&quot;&gt;&lt;/script&gt;\n  &lt;script&gt;\n    $(&quot;#butt_on&quot;).click(function (event) {\n      event.preventDefault();\n      $.get(&quot;/control/on&quot;, function (data, status) {\n        alert(&quot;Data: &quot; + data + &quot;\\nStatus: &quot; + status);\n      });\n    });\n    $(&quot;#butt_off&quot;).click(function (event) {\n      event.preventDefault();\n      $.get(&quot;/control/off&quot;, function (data, status) {\n        alert(&quot;Data: &quot; + data + &quot;\\nStatus: &quot; + status);\n      });\n    });\n  &lt;/script&gt;\n&lt;/html&gt;</code></pre></div>\n\n\n\n<p id=\"4226\">‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πä‡∏î‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á button tag ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏î ‡πÄ‡∏õ‡∏¥‡∏î ‡πÅ‡∏•‡∏∞ ‡∏õ‡∏¥‡∏î ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î event ‡∏Å‡∏≤‡∏£ click ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Endpoint URL <em>/control/on</em> ‡πÅ‡∏•‡∏∞ <em>/control/off</em> ‡∏ú‡πà‡∏≤‡∏ô method GET ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</p>\n\n\n\n<p id=\"f5bd\"><strong>‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏Å‡πá‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 ‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å MQTT publish ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á MQTT ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á Tasmota ‡∏Å‡∏±‡∏ô</strong></p>\n\n\n\n<p id=\"eb9a\">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πä‡∏î‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ route ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå route/index.js ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î Sonoff ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• publish ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Tasmota ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö </p>\n\n\n\n<div class=\"hcb_wrap\"><pre class=\"prism line-numbers lang-js\" data-lang=\"JavaScript\"><code>const main = (app, client) =&gt; {\n  /* GET home page. */\n  app.get(&#39;/&#39;, function (req, res) {\n    res.render(&#39;index&#39;, {\n      title: &#39;nodejs-tasmota&#39;\n    });\n  });\n\n  app.get(&#39;/control/on&#39;, function (req, res) {\n    const fullTopic = `tasmota/cmnd/tasmota-1/POWER`\n    client.publish(fullTopic, &quot;ON&quot;);\n    res.send(&#39;Turn on!&#39;)\n  })\n\n  app.get(&#39;/control/off&#39;, function (req, res) {\n    const fullTopic = `tasmota/cmnd/tasmota-1/POWER`\n    client.publish(fullTopic, &quot;OFF&quot;);\n    res.send(&#39;Turn off!&#39;)\n  })\n}\n\nmodule.exports = main;</code></pre></div>\n\n\n\n<p id=\"7e97\">‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Configuration ‡∏Ç‡∏≠‡∏á Sonoff ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Topic ‡πÅ‡∏•‡∏∞ Full Topic ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ subscribe</p>\n\n\n\n<ul><li><strong><em>Topic: tasmota-1</em></strong></li><li><strong><em>Full Topic: tasmota/%prefix%/%topic%/</em></strong></li></ul>\n\n\n\n<p id=\"ced7\">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î Save ‡πÅ‡∏•‡πâ‡∏ß Sonoff ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ restart ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡πâ‡∏≤ Sonoff ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö web application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÅ‡∏•‡πâ‡∏ß</p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter\"><img src=\"https://miro.medium.com/max/1498/1*KzowlRg7f3O-3AKXTrGqpQ.png\" alt=\"Image for post\"/></figure></div>\n\n\n\n<p><strong>Fulltopic : tasmota/${prefix}/${topic}/</strong></p>\n\n\n\n<ul><li><strong><em>tasmota</em></strong> ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ</li><li><strong><em>prefix</em></strong> ‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏ä‡πà‡∏ô cmnd, stat, tele</li><li><strong>topic </strong>‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏ñ‡∏∂‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏±‡πâ‡∏ô‡πÜ‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πà‡∏ô device_1, device_2</li></ul>\n\n\n\n<p id=\"cea0\">‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ publish ‡πÑ‡∏õ‡∏¢‡∏±‡∏á MQTT broker ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á topic ‡πÉ‡∏ô application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Fulltopic ‡∏Ç‡∏≠‡∏á Tasmota ‡∏ã‡∏∂‡πà‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Sonoff ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏¢‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á prefix ‡∏ô‡∏±‡πâ‡∏ô‡πÜ‡∏Ñ‡∏∑‡∏≠ POWER</p>\n\n\n\n<p id=\"b35c\">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô application ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</p>\n\n\n\n<pre class=\"wp-block-preformatted\">$ npm start</pre>\n\n\n\n<p id=\"4bb5\">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î web browser ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href=\"http://localhost:3000\"><strong>http://localhost:3000</strong></a> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter\"><img src=\"https://miro.medium.com/max/392/1*5GYz10EaylHCBNq58ciCnQ.gif\" alt=\"Image for post\"/></figure></div>\n\n\n\n<p id=\"a2ce\">‡∏à‡∏£‡∏¥‡∏á‡πÜ‡πÅ‡∏•‡πâ‡∏ß Tasmota firmware ‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏≠‡∏µ‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà response ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß firmware ‡πÅ‡∏•‡πâ‡∏ß‡∏ú‡πà‡∏≤‡∏ô MQTT ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Dashboard ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡πà‡∏≤‡∏á‡πÜ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ó‡∏≥ Smarthome ‡πÄ‡∏≠‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ Smart ‡∏ï‡πà‡∏≤‡∏á‡πÜ Tasmota ‡πÅ‡∏•‡∏∞ Sonoff ‡∏ô‡∏µ‡πâ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á hardware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏î ‡∏Å‡∏£‡∏≤‡∏ö‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö <img src=\"https://s.w.org/images/core/emoji/13.0.0/72x72/1f642.png\" alt=\"üôÇ\" class=\"wp-smiley\" style=\"height: 1em; max-height: 1em;\" /></p>\n\n\n\n<h1 id=\"5eaa\">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö</h1>\n\n\n\n<ul><li><strong>Github code example</strong></li></ul>\n\n\n\n<blockquote class=\"wp-block-quote\"><p><a href=\"https://github.com/toygame/nodejs-tasmota\" target=\"_blank\" rel=\"noreferrer noopener\">toygame/<strong>nodejs-tasmota</strong></a></p><cite>https://github.com/toygame/nodejs-tasmota</cite></blockquote>\n<p>The post <a rel=\"nofollow\" href=\"https://thanapon.info/sonoff-mqtt/\">[MQTT] ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ MQTT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Sonoff ‡∏î‡πâ‡∏ß‡∏¢ NodeJS ‡∏Ñ‡∏£‡∏±‡∏ö</a> appeared first on <a rel=\"nofollow\" href=\"https://thanapon.info\">Thanapon</a>.</p>","author":"thanapon.tap","siteTitle":"Thanapon","siteHash":"6a039c2f54d76e4c49227d80968f2a30de5427cc57525c047c383ea3563cde5f","entryHash":"6e7d0a8cbbf89ca66c306146f810b63731c6989f9a1ce7c989edeba9c34809b4","category":"Thai"}